---
title: 多种光源
tags:
  - Shader
  - Shader基础
  - 光源
categories:
  - [技术美术, UnityShader, 光照]
author:
  - nightstardawn
---

# 多种光源

## 一、Shader 开发中常用的光源属性

Unity 中支持四种光源类型
![Snipaste_2024-09-21_21-10-22.png](https://s2.loli.net/2024/09/21/EfscRHYwyGm9qKN.png)

Shader 开发中常用的光源属性：

- 位置
- 方向
- 颜色
- 强度
- 衰减

## 二、逐个分析各种光源在 Shader 当中的作用

### 1.Directional 方向光

1. 充当角色：太阳
2. 照射范围：无限制
3. 特点：
   1. 不存在固定属性
   2. 重要属性只有方向（通过 Tramsform 的 Rotation 属性来改变方向）
   3. 它到场景中所有点的方向都一样
   4. 由于没有位置，因此没有衰减的概念，即光的强度不会随着距离而发生变化

### 2.点光源

1. 充当角色：灯泡、蜡烛等
2. 照射范围：有限
3. 特点：
   1. 它的光是由一个点发出，向西面八方衍生的光
   2. 它的参数范围由 Range 来决定
   3. 它的位置由 Transform 中的 Position 决定
   4. 它存在衰减，随着物体离光源距离决定衰减强度

### 2.聚光灯

1. 充当角色：探照灯、手电筒等
2. 照射范围：有限
3. 特点：
   1. 它的光的范围由空间中的一块锥形区域决定的
   2. 它的参数范围由 Range 和 SpotAngle 来决定
   3. 它的位置由 Transform 中的 Position 决定
   4. 它存在衰减，随着物体离聚光灯距离决定衰减强度
      但是它相对点光源的计算公式更加复杂，因为需要该点是否在锥型范围内

### 3.Area 面光源

因为该光源需要 Bake（烘焙），所以在 Shader 中不讨论

## 三、如何 Shader 中判断光源类型

### 1.前向渲染路径中我们主要关注处理什么样的内容？

两个 Pass

1. Base Pass(基础渲染通道，每个光源只会计算一次)
   只需要处理一个逐像素平行光源(一般场景中最亮会自动赋值对应变量)
   其他的中质量光源(逐顶点)、低质量光源(SH)，Unity 会帮助我们处理
2. Additional Pass(附加渲染通道)
   除了最亮的平行光、 其他高质量的光源(可能是平行光、点光源、聚光灯)都会掉用一次该 Pass 进行计算

因此：我们一般需要在 Additional Pass 中判断光源的类型来区分处理部分逻辑

### 2.具体实现

Unity 中提供了三个重要的宏
用于在编译时根据条件判断 来包含或者排除不同代码块，实现条件编译

- \_DIRECTIONAL_LIGHT 平行光
- \_POINT_LIGHT 点光源
- \_SPOT_LIGHT LIGHT 聚光灯

通过宏配合 UnityShader 中的条件编译预处理指令 即可包含或者排除不同代码块

```cs
#if defined(_DIRECTIONAL_LIGHT)
//平行光逻辑
#elif defined(_POINT_LIGHT)
//点光源逻辑
#elif defined(_SPOT_LIGHT)
//聚光灯逻辑
#else
//其他逻辑
#endif
```

Unity 底层就会根据该条件编译指令
生成多个 Shader Variants(着色器变体)
这些 Variants 变体共享相同的核心代码
但是根据这些条件编译的选择包含不同的代码块

> Shader Variants 着色器变体的概念：
> 通过条件编译指令(#if、#elif、#else、#endif)
> 根据不同的配置选项生成多个版本的 Shader
> 这些不同版本的 Shader 称为 Shader Variants。
