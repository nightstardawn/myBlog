---
title: 获取全局变量和函数
tags:
  - 程序语言
  - 热更新
  - AssetBundle
categories:
  - [热更新, AssetBundle]
author:
  - nightstardawn
---

# 获取全局变量和函数

## 一、获取全局变量的方法

使用 lua 解析器 evn 中 的 Global 属性

```cs
int i = LuaMgr.Instance.Global.Get<int>("testNumber");
bool b = LuaMgr.Instance.Global.Get<bool>("testBool");
Debug.Log("testNumber" + i);
Debug.Log("testBool" + b);
```

## 二、更改全局变量

```cs
LuaMgr.Instance.Global.Set("testNumber", 10);
int i2 = LuaMgr.Instance.Global.Get<int>("testNumber");
Debug.Log("testNumber" + i2);
```

## 三、获取全局函数

### 1.无参无返回

#### 1）.自己写委托

```cs
//无参无返回的委托
public delegate void CustomCall();

//自己写委托
CustomCall call = LuaMgr.Instance.Global.Get<CustomCall>("testFun");
call();
```

#### 2）.UnityAction

```cs
//Unity自带的委托
UnityAction ua = LuaMgr.Instance.Global.Get<UnityAction>("testFun");
ua();
```

#### 3）.Action

```cs
//C#自带提供的委托
Action ac = LuaMgr.Instance.Global.Get<Action>("testFun");
ac();
```

#### 4）.LuaFunction

```cs
//xLua提供的一种方式
LuaFunction lF = LuaMgr.Instance.Global.Get<LuaFunction>("testFun");
lF.Call();
```

### 2.有参有返回

#### 1）.自己写委托

```cs
//有参有返回值 ---注意要编辑器中 重新生成xlua代码
[CSharpCallLua] public delegate int CustomCall2(int a);

//自己写委托
CustomCall2 call2 = LuaMgr.Instance.Global.Get<CustomCall2>("testFun2");
Debug.Log(call2(10));
```

#### 2）.Action

```cs
//C#自带提供的委托
Func<int, int> sFun = LuaMgr.Instance.Global.Get<Func<int, int>>("testFun2");
Debug.Log(sFun(20));
```

#### 3）.LuaFunction

```cs
//xLua提供的一种方式
LuaFunction lF2 = LuaMgr.Instance.Global.Get<LuaFunction>("testFun2");
Debug.Log(lF2.Call(30)[0]);
```

### 3.多返回

#### 1）.自己写委托

##### A.out

```cs
[CSharpCallLua] public delegate int CustomCall3(int a, out int b, out bool c, out string d, out int e);
//out传递
CustomCall3 call3 = LuaMgr.Instance.Global.Get<CustomCall3>("testFun3");
int b;
bool c;
string d;
int e;
Debug.Log(call3(100, out b, out c, out d, out e));
Debug.Log(b + "_" + c + "_" + d + "_" + e);
```

##### B.ref

```cs

[CSharpCallLua] public delegate int CustomCall4(int a, ref int b, ref bool c, ref string d, ref int e);
//ref传递
CustomCall4 call4 = LuaMgr.Instance.Global.Get<CustomCall4>("testFun3");
int b1 = 0;
bool c1 = true;
string d1 = "";
int e1 = 0;
Debug.Log(call4(100, ref b1, ref c1, ref d1, ref e1));
Debug.Log(b + "_" + c + "_" + d + "_" + e);
```

#### 2）.LuaFunction

```cs
//xLua提供的一种方式
LuaFunction lF3 = LuaMgr.Instance.Global.Get<LuaFunction>("testFun3");
object[] ojbs = lF3.Call(1000);
for (int i = 0; i < ojbs.Length; i++)
{
    Debug.Log($"第{i}个返回值是" + ojbs[i]);
}

```

### 4.变长参数

#### 1）.自己写委托

```cs
//自己写委托 --- 变长参数的类型是由 实际的函数决定的
[CSharpCallLua] public delegate int CustomCall5(int a, params object[] args);

CustomCall5 call5 = LuaMgr.Instance.Global.Get<CustomCall5>("testFun4");
call5(1010, 1, 1, "23", 4, 6, "5", true);
```

#### 2）.LuaFunction

```cs
//xLua提供的一种方式
LuaFunction lF4 = LuaMgr.Instance.Global.Get<LuaFunction>("testFun4");
lF4.Call(1010, 1, 1, "23", 4, 6, "5", true);
```
